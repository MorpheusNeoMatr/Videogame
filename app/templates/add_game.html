{% extends "layout.html" %}
{% block content %}
<h2>Add Game</h2>

<form method="POST" action="{{ url_for('add_game') }}">
  {{ series_form.hidden_tag() }}
  <label for="series_name">Series Name:</label>
  {{ series_form.series_name() }}<br>

  <button type="submit">Add Series</button>
</form>

<br>

<form method="POST" action="{{ url_for('add_game') }}">
  {{ genre_form.hidden_tag() }}
  <label for="genre_name">Genre name:</label>
  {{ genre_form.genre_name() }}<br>

  <button type="submit">Add genre</button>
</form>


<form method="POST" action="{{ url_for('add_game') }}" enctype="multipart/form-data">
  {{ game_form.csrf_token }}
  <p>Game: {{ game_form.game_name(maxlength=30) }} <span>{{ game_form.game_name.errors }}</span></p>
  <p>Dev score: {{ game_form.game_dev_score }} <span style="color:red">{{ game_form.game_dev_score.errors }}</span></p>
  <p>Release date: {{ game_form.game_date }} <span style="color:red">{{ game_form.game_date.errors }}</span></p>


  <p>Directors: 
    <button type="button" id="toggleDirectors" class="toggle-button">
      Select Directors <span class="arrow down" id="arrowDirectors"></span>
    </button>
    <div id="directorsList" class="dropdown-list">
      {% for director in game_form.game_directors.choices|sort(attribute=1) %}
        <label>
          <input type="checkbox" class="checkbox-director" name="game_directors" value="{{ director[0] }}">
          {{ director[1] }}
        </label><br>
      {% endfor %}
    </div>
  </p>

  <p>Series:
    <select name="game_series">
      <option>No series</option>
      {% for series in game_form.game_series.choices|sort(attribute=1) %}
        <option value="{{ series[0] }}">{{ series[1] }}</option>
      {% endfor %}
    </select>
    <span style="color:red">{{ game_form.game_series.errors }}</span>
  </p>
  

  <p>Companies: 
    <button type="button" id="toggleCompanies" class="toggle-button">
      Select Companies <span class="arrow down" id="arrowCompanies"></span>
    </button>
    <div id="companiesList" class="dropdown-list">
      {% for company in game_form.game_companies.choices|sort(attribute=1) %}
        <label>
          <input type="checkbox" class="checkbox-company" name="game_companies" value="{{ company[0] }}">
          {{ company[1] }}
        </label><br>
      {% endfor %}
    </div>
  </p>


  <p>Genres: 
    <button type="button" id="toggleGenres" class="toggle-button">
      Select Genres <span class="arrow down" id="arrowGenres"></span>
    </button>{{ game_form.game_genres.errors }}
    <div id="genresList" class="dropdown-list">
      {% for genre in game_form.game_genres.choices|sort(attribute=1) %}
        <label>
          <input type="checkbox" class="checkbox-genre" name="game_genres" value="{{ genre[0] }}">
          {{ genre[1] }}
        </label><br>
      {% endfor %}
    </div>
  </p>

  <p>Picture 1: {{ game_form.game_picture_1 }} <span style="color:red">{{ game_form.game_picture_1.errors }}</span></p>
  <p>Picture 2: {{ game_form.game_picture_2 }} <span style="color:red">{{ game_form.game_picture_2.errors }}</span></p>
  <p>Picture 3: {{ game_form.game_picture_3 }} <span style="color:red">{{ game_form.game_picture_3.errors }}</span></p>
  <p>Picture 4: {{ game_form.game_picture_4 }} <span style="color:red">{{ game_form.game_picture_4.errors }}</span></p>
  <p>Picture 5: {{ game_form.game_picture_5 }} <span style="color:red">{{ game_form.game_picture_5.errors }}</span></p>
  <p>Picture 6: {{ game_form.game_picture_6 }} <span style="color:red">{{ game_form.game_picture_6.errors }}</span></p>
  <p>Description: {{ game_form.game_description }} <span style="color:red">{{ game_form.game_description.errors }}</span></p>
  <p>Gameplay: {{ game_form.game_gameplay }} <span style="color:red">{{ game_form.game_gameplay.errors }}</span></p>
  <p>Story: {{ game_form.game_story }} <span style="color:red">{{ game_form.game_story.errors }}</span></p>
  <p>Soundtrack: {{ game_form.game_soundtrack }} <span style="color:red">{{ game_form.game_soundtrack.errors }}</span></p>
  <p>Reviews: {{ game_form.game_reviews }} <span style="color:red">{{ game_form.game_reviews.errors }}</span></p>

  <input type="submit" value="Add this game">
</form>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    function setupDropdownToggle(buttonId, listId, arrowId) {
      const button = document.getElementById(buttonId);
      const list = document.getElementById(listId);
      const arrow = document.getElementById(arrowId);

      button.addEventListener('click', function() {
        const isVisible = list.style.display === 'block';
        list.style.display = isVisible ? 'none' : 'block';
        arrow.classList.toggle('up', !isVisible);
        arrow.classList.toggle('down', isVisible);
      });
    }

    setupDropdownToggle('toggleDirectors', 'directorsList', 'arrowDirectors');
    setupDropdownToggle('toggleCompanies', 'companiesList', 'arrowCompanies');
    setupDropdownToggle('toggleGenres', 'genresList', 'arrowGenres');

    function limitCheckboxSelection(className, limit) {
      const checkboxes = document.querySelectorAll(className);
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checkedCheckboxes = document.querySelectorAll(className + ':checked');
          if (checkedCheckboxes.length > limit) {
            this.checked = false;
            alert('You can only select up to ' + limit + ' options.');
          }
        });
      });
    }

    limitCheckboxSelection('.checkbox-director', 3);
    limitCheckboxSelection('.checkbox-company', 3);
    limitCheckboxSelection('.checkbox-genre', 3);
  });
</script>




{% endblock %}