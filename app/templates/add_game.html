{% extends "layout.html" %}
{% block content %}
<div class="page-name">
  <h1>ADD GAME</h1>
</div>


<div id="popup-series" class="popup">
  <div class="popup-content">
      <span id="closePopupSeriesBtn" class="close">&times;</span>
      <form method="POST" action="{{ url_for('add_game') }}">
        {{ series_form.hidden_tag() }}
        <input type="text" class="add_stuff_bar" name="series_name" placeholder="Add Series"><br><br>
        <button type="submit">Add Series</button>
      </form>
  </div>
</div>

<br>

<div id="popup-genre" class="popup">
  <div class="popup-content">
      <span id="closePopupGenreBtn" class="close">&times;</span>
      <form method="POST" action="{{ url_for('add_game') }}">
        {{ genre_form.hidden_tag() }}
        <input type="text" class="add_stuff_bar" name="genre_name" placeholder="Add Genre"><br><br>
        <button type="submit">Add genre</button>
      </form>
  </div>
</div>



<form method="POST" action="{{ url_for('add_game') }}" enctype="multipart/form-data">
  {{ game_form.csrf_token }}
  <input type="text" class="add_stuff_bar" name="game_name" placeholder="Game name"><br><br>
  <input type="text" class="add_stuff_bar" name="game_dev_score" placeholder="Your score">
  <br><br>
  <input type="date" class="add_stuff_bar" name="game_date" placeholder="Realease date">
  <br><br>

  <button type="button" id="toggleDirectors" class="toggle-button">
    Select Directors <span class="arrow down" id="arrowDirectors"></span>
  </button>
  <div id="directorsList" class="dropdown-list">
    {% for director in game_form.game_directors.choices|sort(attribute=1) %}
      <label>
        <input type="checkbox" class="checkbox-director" name="game_directors" value="{{ director[0] }}">
        {{ director[1] }}
      </label><br>
    {% endfor %}
  </div>


  <p>Series:
    <select name="game_series">
      <option>No series</option>
      {% for series in game_form.game_series.choices|sort(attribute=1) if series[1] != 'No series'%}
        <option value="{{ series[0] }}">{{ series[1] }}</option>
      {% endfor %}
    </select>
    <span style="color:red">{{ game_form.game_series.errors }}</span>
    <button type="button" id="openPopupSeriesBtn">Add Series</button>
  </p>
  

  <p>Companies: 
    <button type="button" id="toggleCompanies" class="toggle-button">
      Select Companies <span class="arrow down" id="arrowCompanies"></span>
    </button>
    <div id="companiesList" class="dropdown-list">
      {% for company in game_form.game_companies.choices|sort(attribute=1) %}
        <label>
          <input type="checkbox" class="checkbox-company" name="game_companies" value="{{ company[0] }}">
          {{ company[1] }}
        </label><br>
      {% endfor %}
    </div>
  </p>


  <p>Genres: 
    <button type="button" id="toggleGenres" class="toggle-button">
      Select Genres <span class="arrow down" id="arrowGenres"></span>
    </button>{{ game_form.game_genres.errors }}
    <div id="genresList" class="dropdown-list">
      {% for genre in game_form.game_genres.choices|sort(attribute=1) %}
        <label>
          <input type="checkbox" class="checkbox-genre" name="game_genres" value="{{ genre[0] }}">
          {{ genre[1] }}
        </label><br>
      {% endfor %}
    </div>
    <div id="popup-genre" class="popup">
      <div class="popup-content">
          <span id="closePopupBtn" class="close">&times;</span>
          <form method="POST" action="{{ url_for('add_game') }}">
            {{ genre_form.hidden_tag() }}
            <label for="genre_name">Genre name:</label>
            <input type="text" class="add_stuff_bar" name="genre_name" placeholder="Add Genre"><br><br>
            <button type="submit">Add genre</button>
          </form>
      </div>
    </div>
    <button type="button" id="openPopupGenreBtn">Add Genre</button>
  </p>

  <p>Picture 1: {{ game_form.game_picture_1 }} <span style="color:red">{{ game_form.game_picture_1.errors }}</span></p>
  <p>Picture 2: {{ game_form.game_picture_2 }} <span style="color:red">{{ game_form.game_picture_2.errors }}</span></p>
  <p>Picture 3: {{ game_form.game_picture_3 }} <span style="color:red">{{ game_form.game_picture_3.errors }}</span></p>
  <p>Picture 4: {{ game_form.game_picture_4 }} <span style="color:red">{{ game_form.game_picture_4.errors }}</span></p>
  <p>Picture 5: {{ game_form.game_picture_5 }} <span style="color:red">{{ game_form.game_picture_5.errors }}</span></p>
  <input type="file" class="add_stuff_bar" name="game_description" placeholder="Add picture 6">
  <br><br>
  <textarea class="add_stuff_bar" name="game_description" placeholder="Add description" rows="6" cols="50"></textarea>
  <br><br>
  <textarea class="add_stuff_bar" name="game_story" placeholder="Add story" rows="6" cols="50"></textarea>
  <br><br>
  <textarea class="add_stuff_bar" name="game_gameplay" placeholder="Add gameplay" rows="6" cols="50"></textarea>
  <br><br>
  <textarea class="add_stuff_bar" name="game_soundtrack" placeholder="Add soundtrack" rows="6" cols="50"></textarea>
  <br><br>
  <textarea class="add_stuff_bar" name="game_reviews" placeholder="Add reviews" rows="6" cols="50"></textarea>
  <br><br>
  <input  type="submit" value="Add this game">
</form>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    function setupDropdownToggle(buttonId, listId, arrowId) {
      const button = document.getElementById(buttonId);
      const list = document.getElementById(listId);
      const arrow = document.getElementById(arrowId);

      button.addEventListener('click', function() {
        const isVisible = list.style.display === 'block';
        list.style.display = isVisible ? 'none' : 'block';
        arrow.classList.toggle('up', !isVisible);
        arrow.classList.toggle('down', isVisible);
      });
    }

    setupDropdownToggle('toggleDirectors', 'directorsList', 'arrowDirectors');
    setupDropdownToggle('toggleCompanies', 'companiesList', 'arrowCompanies');
    setupDropdownToggle('toggleGenres', 'genresList', 'arrowGenres');

    function limitCheckboxSelection(className, limit) {
      const checkboxes = document.querySelectorAll(className);
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const checkedCheckboxes = document.querySelectorAll(className + ':checked');
          if (checkedCheckboxes.length > limit) {
            this.checked = false;
            alert('You can only select up to ' + limit + ' options.');
          }
        });
      });
    }

    limitCheckboxSelection('.checkbox-director', 3);
    limitCheckboxSelection('.checkbox-company', 3);
    limitCheckboxSelection('.checkbox-genre', 3);

    // Popup functionality
    var popupSeries = document.getElementById("popup-series");
    var openPopupSeriesBtn = document.getElementById("openPopupSeriesBtn");
    var closePopupSeriesBtn = document.getElementById("closePopupSeriesBtn");

    openPopupSeriesBtn.onclick = function() {
        popupSeries.style.display = "block";
    };

    closePopupSeriesBtn.onclick = function() {
        popupSeries.style.display = "none";
    };

    window.onclick = function(event) {
        if (event.target == popupSeries) {
            popupSeries.style.display = "none";
        }
    };

    // Popup functionality for Genre
    var popupGenre = document.getElementById("popup-genre");
    var openPopupGenreBtn = document.getElementById("openPopupGenreBtn");
    var closePopupGenreBtn = document.getElementById("closePopupGenreBtn");

    openPopupGenreBtn.onclick = function() {
        popupGenre.style.display = "block";
    };

    closePopupGenreBtn.onclick = function() {
        popupGenre.style.display = "none";
    };

    window.onclick = function(event) {
        if (event.target == popupGenre) {
            popupGenre.style.display = "none";
        }
    };
  });
</script>





{% endblock %}